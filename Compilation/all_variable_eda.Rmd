---
title: "EDA for Variables"
date: "11/11/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(psych)
library("gridExtra") 
```

We first import the dataset

```{r}
students <- read_csv("../data/student-mat.csv")
```
Throughout this analysis, we will also be recoding variables to make our variable values more understandable.

```{r}
students_recoded <- students
```


We then proceed to conduct Exploratory Data Analysis on each variable, to try to determine which variables look interesting

Here are the list of variables that are present in the data:

## Part 1: Dependent variable

For this project, we will be focusing on `Walc`, or weekend alcohol consumption.


## Part 2: Independent Variables

There are 31 variables that are present in the dataset

1) `school` - The school that the student belongs to (“GP”: Gabriel Pereira or “MS”: Mousinho da Silveira)
2) `sex`    - The sex of the student (“'F”: Female or “M”: Male)
3) `age`    - The age of the students (Ranges from 15 to 22)
4) `address`- The area that the student’s home is located (“U”: Urban or “R”: Rural) 
5) `famsize`- The size of the student’s family (“LE3”: Less than or equal to 3 or “GT3”: Greater than or equal to 3)
6) `Pstatus`- The status of whether the parents live together or are separated. ('A': Alone, 'T': Together)
7) `Medu`   - The student's Mother’s education level, with 0 being non-educated, and 4 being in higher/tertiary education.
8) `Fedu` 
9) `Mjob` 
10) `Fjob`
11) `reason`
12) `guardian`
13) `traveltime`
14) `studytime`
15) `failures` 
16) `schoolsup` 
17) `famsup` 
18) `paid`
19) `activities`
20) `nursery` 
21) `higher` 
22) `internet`
23) `romantic` 
24) `famrel` 
25) `freetime` 
26) `goout`
27) `health`
28) `absences` 
29) `G1`
30) `G2`
31) `G3`

We will now proceed to walk through these variables one by one and examine whether they are significant in predicting alcohol level


### 1) School

This variable describes the student's school (binary: 'GP' - Gabriel Pereira or 'MS' - Mousinho da Silveira)

```{r}
students %>% 
  group_by(school) %>% 
  summarize(count=n())

data1 <- students %>% 
  group_by(Walc, school) %>% 
  summarize(count=n(), .groups="drop") %>% 
  mutate(total=case_when(school=="GP"~349, 
                         school=="MS"~46)) %>% 
  mutate(p=count/total)

data1 %>% 
  ggplot() +
  geom_bar(aes(Walc, p, fill=school), position="dodge", stat="identity") +
  ggtitle("Proportion of Students in Each Weekend Consumption Level by School") + 
  ylab("Proportion") +
  xlab("Weekend Consumption Level")
```

It seems that there are more students studying at Gabriel Pereira (GP) secondary school than Mousinho da Silveira (MS) secondary school. 

If we look at the barplot above, we observe that for the weekend consumption levels, it looks like students in the MS secondary school have a higher consumption level on average than GP high school. Hence, school looks to be a significant factor.


### 2) sex 

This variable describes the student's sex (binary: 'F' - female or 'M' - male)

```{r}
students %>% 
  group_by(sex) %>% 
  summarize(count=n())

data2 <- students %>% 
  group_by(sex, Walc) %>% 
  summarize(count=n(), .groups="drop") %>% 
  mutate(total=case_when(sex=="F"~208, 
                         sex=="M"~187)) %>% 
  mutate(p=count/total)

data2 %>% 
  ggplot() +
  geom_bar(aes(Walc, p, fill=sex), position="dodge", stat="identity") +
  ggtitle("Proportion of Students in Each Weekend Consumption Level by Sex") + 
  ylab("Proportion") +
  xlab("Weekend Consumption Level")
```

It seems that there are slightly more female students than male students in the dataset.

From these plots, it appears that males are more likely to drink more alcohol than female students. Hence, sex looks to be a significant factor as well.


### 3) age 

This variable describes the student's age. It is a numeric variable ranging from 15 to 22 years old.

```{r}
students %>% 
  group_by(age) %>% 
  summarize(count=n())

data2 <- students %>% 
  group_by(age, Walc) %>% 
  summarize(count=n(), .groups="drop")

data2 %>% 
  ggplot() +
  geom_bar(aes(Walc, count, fill=age), position="stack", stat="identity") +
  ggtitle("Counts of Students in Each Weekend Consumption Level by Age") + 
  ylab("Counts") +
  xlab("Weekend Consumption Level") +
  facet_grid(~age)
```

From the table output, we see that most of the studens in the dataset are 15-18 years old. Additionally, it looks like the younger students (15 and 16 year olds) have a really low alcohol consumption rate compared to the older students, so age could be a significant variable.


### 4) address 

This variable describes the student's home address type (binary: 'U' - urban or 'R' - rural)

```{r}
students %>% 
  group_by(address) %>% 
  summarize(count=n())

data2 <- students %>% 
  group_by(address, Walc) %>% 
  summarize(count=n(), .groups="drop") %>% 
  mutate(total=case_when(address=="R"~88, 
                         address=="U"~307)) %>% 
  mutate(p=count/total)

data2 %>% 
  ggplot() +
  geom_bar(aes(Walc, p, fill=address), position="dodge", stat="identity") +
  ggtitle("Proportion of Students in Each Weekend Consumption Level by Location") + 
  ylab("Proportion") +
  xlab("Weekend Consumption Level")
```

It seems that most students in the dataset live in urban areas.

From these plots, it appears that students living in rural areas are more likely to drink more alcohol than students in urban areas. Hence, address looks to be a significant factor as well.


### 5) famsize 

This variable describes the student family size (binary: 'LE3' - less or equal to 3 or 'GT3' - greater than 3)

```{r}
students %>% 
  group_by(famsize) %>% 
  summarize(count=n())

data2 <- students %>% 
  group_by(famsize, Walc) %>% 
  summarize(count=n(), .groups="drop") %>% 
  mutate(total=case_when(famsize=="GT3"~281, 
                         famsize=="LE3"~114)) %>% 
  mutate(p=count/total)

data2 %>% 
  ggplot() +
  geom_bar(aes(Walc, p, fill=famsize), position="dodge", stat="identity") +
  ggtitle("Proportion of Students in Each Weekend Consumption Level by Family Size") + 
  ylab("Proportion") +
  xlab("Weekend Consumption Level")
```

It seems that most students in the dataset have a family size less than or equal to 3.

From these plots, it appears that students who have a smaller family size are more likely to drink more alcohol than students who have a larger family size. Hence, famsize looks to be a significant factor as well.



6) Pstatus - parent's cohabitation status (binary: 'T' - living together or 'A' - apart)

`Pstatus` is a binary variable that reflects the status of whether the parents live together or are separated. The status of parenthood can emotionally affect these student’s lives, which might influence how much alcohol they consume as a coping mechanism to their emotional trauma. (T' - living together or 'A' - apart)


```{r}

students %>% 
  group_by(Pstatus) %>% 
  summarize(count=n())

Pstatus_EDA2 <- students %>% 
  group_by(Pstatus, Walc) %>% 
  summarize(count=n(), .groups="drop") %>%
  mutate(total=case_when(Pstatus=="A"~41, 
                         Pstatus=="T"~354)) %>% 
  mutate(prop=count/total)

ggplot(Pstatus_EDA2, aes(x=Walc, y=prop, fill=Pstatus)) + geom_col(position="dodge") + ggtitle("Proportion of Students\nby Parent Status") + 
  xlab("Weekend Consumption Level") + ylab("Proportion") +
  scale_fill_discrete(name="Parent Status",
                         breaks=c("A", "T"),
                         labels=c("Apart", "Together"))


```

It seems that most students in the dataset have parents who live together.

From this, we can see that for the most extreme levels of weekend alcohol consumption levels (from a low 1 to high 4-5), students whose parents stay apart have a higher alcohol consumption level than students whose parents live together.

7) Medu - mother's education (numeric: 0 - none, 1 - primary education (4th grade), 2 – 5th to 9th grade, 3 – secondary education or 4 – higher education)

`Medu` is an ordinal-valued variable reflecting the student's mother's educational level, set at arbitrary levels which are mostly closely related to the levels of the mother’s education, with 0 being non-educated, and 4 being in higher/tertiary education. The mother’s education level might influence the way the student is brought up at home, which in turn might influence how much alcohol the student chooses to consume. (numeric: 0 - none, 1 - primary education (4th grade), 2 – 5th to 9th grade, 3 – secondary education or 4 – higher education)

For weekday consumption levels, all mother's education seem to project low alcohol consumption levels but with a few outliers. For weekend consumption levels, the highest frequencies belong to the lowest Mother's education.

```{r}

p1 <- ggplot(main_cols, mapping=aes(x=Dalc)) +
  geom_bar(aes(fill=as.factor(Medu)),position="dodge") + 
  ggtitle("Count of Students\nby Mother's Education") + 
  xlab("Weekday Consumption Level") + ylab("Count") +
  scale_fill_discrete(name="Mother's Education")

p2 <- ggplot(main_cols, mapping=aes(x=Walc)) +
  geom_bar(aes(fill=as.factor(Medu)),position="dodge") + 
  ggtitle("Count of Students\nby Mother's Education") + 
  xlab("Weekend Consumption Level") + ylab("Count") +
  scale_fill_discrete(name="Mother's Education")

grid.arrange(p1, p2, ncol = 2)

```

Generally, the lowest counts of consumption levels for both weekdays and weekends belong to Mother's with the highest education level.

8) Fedu - father's education (numeric: 0 - none, 1 - primary education (4th grade), 2 – 5th to 9th grade, 3 – secondary education or 4 – higher education)
9) Mjob - mother's job (nominal: 'teacher', 'health' care related, civil 'services' (e.g. administrative or police), 'at_home' or 'other')
10) Fjob - father's job (nominal: 'teacher', 'health' care related, civil 'services' (e.g. administrative or police), 'at_home' or 'other')



11) reason - reason to choose this school (nominal: close to 'home', school 'reputation', 'course' preference or 'other')
12) guardian - student's guardian (nominal: 'mother', 'father' or 'other')
13) traveltime - home to school travel time (numeric: 1 - <15 min., 2 - 15 to 30 min., 3 - 30 min. to 1 hour, or 4 - >1 hour)
14) studytime - weekly study time (numeric: 1 - <2 hours, 2 - 2 to 5 hours, 3 - 5 to 10 hours, or 4 - >10 hours)

## Reason
```{r}
reg = lm(Dalc~reason, data=df)
summary(reg)
```

```{r}
ggplot(data=df, mapping=aes(x=reason, y=Dalc)) +
  geom_boxplot()

ggplot(data=df, mapping=aes(x=reason, y=Walc)) +
  geom_boxplot()
```
It appears that for weekday alcohol consumption, students who chose their school due to its 'reputation' tend to have a lower weekday alcohol consumption. We hypothesize that this may be the case as these are the subset of students who we expect to take school more seriously which may in turn result in lower weekday alcohol consumption levels.

Students who chose 'other' as their reason for going to their school have a noticably higher weekend alcohol consumption on average. 

```{r}
table(df$reason, df$Dalc)
```

working on this
```{r}
r = df %>% group_by(reason, Dalc) %>% 
  summarize(count=n())

ggplot(data=r, mapping=aes(x=Dalc, y=count)) + geom_line(aes(group=reason))
```


## Guardian

```{r}
ggplot(data=df, mapping=aes(x=guardian, y=Dalc)) +
  geom_boxplot()

ggplot(data=df, mapping=aes(x=guardian, y=Walc)) +
  geom_boxplot()
```
The three options for guardian all depict similar alcohol consumptions for both weekdays and weekends. This is likely not going to be a key indicator of a student's alcohol consumption. 

## TravelTime

THIS IS A VERY BAD AND USELESS PLOT

The plot fails since almost every combination of (x, y) -> (traveltime, dalc) exists, but the plot does not depict the frequency of these combinations.

```{r}
ggplot(aes(x=traveltime, y=Dalc), data=df) + geom_point() + geom_smooth(method='lm', se=FALSE, color='red')
```


```{r}
reg = lm(Dalc ~ traveltime, data=df)
summary(reg)
```

There is a positive correlation between travel time and weekday alcohol consumption, with a significant regression pvalue. 

```{r}
reg = lm(Walc ~ traveltime, data=df)
summary(reg)
```

Similarly, there is a positive correlation between travel time and weekend alcohol consumption, with a significant regression pvalue. 

## G1 G2 G3
```{r}
reg = lm(Dalc ~ G2, data=df)
summary(reg)
```

G1, G2, and G3 are all correlated to one another as expected. However, none of them have a significant p value in a regression model to predict the weekday and weekend alcohol consumptions.

SUMMARY:

The two categorical variables, reason and guardian, don't seem to have too much promise and relevance in regards to predicting a student's alcohol consumption. However, while it is difficult to visualize travel time against alcohol consumption as both variables are non-continuous, it is definitely worthwhile to include in a regression model. 

```{r}
#1 - <2 hours, 2 - 2 to 5 hours, 3 - 5 to 10 hours, or 4 - >10 hours)
math %>% 
  select(Walc, Dalc, studytime)
ggplot(math, mapping=aes(x=Dalc)) +
  geom_bar(aes(fill=as.factor(studytime)),position="dodge2")

ggplot(math, mapping=aes(x=Walc)) +
  geom_bar(aes(fill=as.factor(studytime)),position="dodge2")


cor(math$studytime, math$Walc)
cor(math$studytime, math$Dalc)
#More they drink, less they study
```

15) failures - number of past class failures (numeric: n if 1<=n<3, else 4)

```{r}
#numeric: n if 1<=n<3, else 4)
math %>% 
  select(Walc, Dalc, failures)
ggplot(math, mapping=aes(x=Dalc)) +
  geom_bar(aes(fill=as.factor(failures)),position="dodge2")

ggplot(math, mapping=aes(x=Walc)) +
  geom_bar(aes(fill=as.factor(failures)),position="dodge2")


cor(math$failures, math$Walc)
cor(math$failures, math$Dalc)
#More they drink, more number of failures
```

16) schoolsup - extra educational support (binary: yes or no)

```{r}

# look at the boxplots of `Dalc` and `Walc` vs. `schoolsup`
p1 <- ggplot(students_modified, aes(x = schoolsup, y = Dalc)) +
  geom_boxplot()
p2 <- ggplot(students_modified, aes(x = schoolsup, y = Walc)) +
  geom_boxplot()
grid.arrange(p1, p2, ncol = 2)

```

```{r}

# look at the histograms of `Dalc` and `Walc` vs. `schoolsup`
p1 <- ggplot(students_modified, aes(x = Dalc)) +
  geom_bar(aes(fill = schoolsup), position="dodge2")
p2 <- ggplot(students_modified, aes(x = Walc)) +
  geom_bar(aes(fill = schoolsup), position="dodge2")
grid.arrange(p1, p2, ncol = 2)


```


17) famsup - family educational support (binary: yes or no)

```{r}

# look at the boxplots of `Dalc` and `Walc` vs. `famsup`
p1 <- ggplot(students_modified, aes(x = famsup, y = Dalc)) +
  geom_boxplot()
p2 <- ggplot(students_modified, aes(x = famsup, y = Walc)) +
  geom_boxplot()
grid.arrange(p1, p2, ncol = 2)

```

```{r}

# look at the histograms of `Dalc` and `Walc` vs. `famsup`
p1 <- ggplot(students_modified, aes(x = Dalc)) +
  geom_bar(aes(fill = famsup), position="dodge2")
p2 <- ggplot(students_modified, aes(x = Walc)) +
  geom_bar(aes(fill = famsup), position="dodge2")
grid.arrange(p1, p2, ncol = 2)

```

18) paid - extra paid classes within the course subject (Math or Portuguese) (binary: yes or no)

```{r}

# look at the boxplots of `Dalc` and `Walc` vs. `paid`
p1 <- ggplot(students_modified, aes(x = paid, y = Dalc)) +
  geom_boxplot()
p2 <- ggplot(students_modified, aes(x = paid, y = Walc)) +
  geom_boxplot()
grid.arrange(p1, p2, ncol = 2)

```

```{r}

# look at the histograms of `Dalc` and `Walc` vs. `paid`
p1 <- ggplot(students_modified, aes(x = Dalc)) +
  geom_bar(aes(fill = paid), position="dodge2")
p2 <- ggplot(students_modified, aes(x = Walc)) +
  geom_bar(aes(fill = paid), position="dodge2")
grid.arrange(p1, p2, ncol = 2)

```


19) activities - extra-curricular activities (binary: yes or no)

```{r}

# look at the boxplots of `Dalc` and `Walc` vs. `activities`
p1 <- ggplot(students_modified, aes(x = activities, y = Dalc)) +
  geom_boxplot()
p2 <- ggplot(students_modified, aes(x = activities, y = Walc)) +
  geom_boxplot()
grid.arrange(p1, p2, ncol = 2)

```

```{r}

# look at the histograms of `Dalc` and `Walc` vs. `activities`
p1 <- ggplot(students_modified, aes(x = Dalc)) +
  geom_bar(aes(fill = activities), position="dodge2")
p2 <- ggplot(students_modified, aes(x = Walc)) +
  geom_bar(aes(fill = activities), position="dodge2")
grid.arrange(p1, p2, ncol = 2)

```

20) nursery - attended nursery school (binary: yes or no)

```{r}

# look at the boxplots of `Dalc` and `Walc` vs. `nursery`
p1 <- ggplot(students_modified, aes(x = nursery, y = Dalc)) +
  geom_boxplot()
p2 <- ggplot(students_modified, aes(x = nursery, y = Walc)) +
  geom_boxplot()
grid.arrange(p1, p2, ncol = 2)

```

```{r}

# look at the histograms of `Dalc` and `Walc` vs. `nursery`
p1 <- ggplot(students_modified, aes(x = Dalc)) +
  geom_bar(aes(fill = nursery), position="dodge2")
p2 <- ggplot(students_modified, aes(x = Walc)) +
  geom_bar(aes(fill = nursery), position="dodge2")
grid.arrange(p1, p2, ncol = 2)

```

21) higher - wants to take higher education (binary: yes or no)

higher - Describes whether the student intends to pursue higher education or not (yes or no)
This variable could be significant, because we could predict that students who intend to pursue higher education are less likely to drink

```{r}
table(students$higher)

ggplot(data=students, mapping=aes(x=Dalc)) +
  geom_bar(aes(fill=higher),position="dodge2")

ggplot(data=students, mapping=aes(x=Walc)) +
  geom_bar(aes(fill=higher),position="dodge2")
```

22) internet - Internet access at home (binary: yes or no)

internet - Describes whether the student has internet access at home (yes or no)

```{r}
table(students$internet)

ggplot(data=students, mapping=aes(x=Dalc)) +
  geom_bar(aes(fill=internet),position="dodge2")

ggplot(data=students, mapping=aes(x=Walc)) +
  geom_bar(aes(fill=internet),position="dodge2")

```

23) romantic - with a romantic relationship (binary: yes or no)

romantic - Describes whether the student is in a romantic relationship or not (yes or no)

```{r}
table(students$romantic)

ggplot(data=students, mapping=aes(x=Dalc)) +
  geom_bar(aes(fill=romantic),position="dodge2")

ggplot(data=students, mapping=aes(x=Walc)) +
  geom_bar(aes(fill=romantic),position="dodge2")
```

24) famrel - quality of family relationships (numeric: from 1 - very bad to 5 - excellent)

famrel - Describes the quality of the student's family relationship (scale of 1 to 5)

```{r}
table(students$famrel)

ggplot(data=students, mapping=aes(x=Dalc)) +
  geom_bar(aes(fill=as.factor(famrel)),position="dodge2")

ggplot(data=students, mapping=aes(x=Walc)) +
  geom_bar(aes(fill=as.factor(famrel)),position="dodge2",stat="identity") +
  ggtitle("Proportion of Students in Each Weekday Consumption Level by Family Size") + 
  ylab("Proportion") +
  xlab("Weekday Consumption Level")
```

25) freetime - free time after school (numeric: from 1 - very low to 5 - very high)

freetime - Describes how much free time the student has (scale of 1 to 5)
```{r}
table(students$freetime)

ggplot(data=students, mapping=aes(x=Dalc)) +
  geom_bar(aes(fill=as.factor(freetime)),position="dodge2")

ggplot(data=students, mapping=aes(x=Walc)) +
  geom_bar(aes(fill=as.factor(freetime)),position="dodge2")


```

26) goout - going out with friends (numeric: from 1 - very low to 5 - very high)

```{r}
table(math$goout)
ggplot(math, mapping=aes(x=Dalc)) +
  geom_bar(aes(fill=as.factor(goout)),position="dodge2")

ggplot(math, mapping=aes(x=Walc)) +
  geom_bar(aes(fill=as.factor(goout)),position="dodge2")

cor(math$goout, math$Walc)
# 0.42 positive correlation, the more they go out, the more they drink during weekends

cor(math$goout, math$Dalc)
# 0.27 positive correlation, the more they go out, the more they drink during weekdays
```

27) health - current health status (numeric: from 1 - very bad to 5 - very good)

```{r}
#5 is very good health, 1 is bad health
table(math$health)
ggplot(math, mapping=aes(x=Dalc)) +
  geom_bar(aes(fill=as.factor(health)),position="dodge2")

ggplot(math, mapping=aes(x=Walc)) +
  geom_bar(aes(fill=as.factor(health)),position="dodge2")


cor(math$health, math$Walc)
#Little to no correlation, but still positive

cor(math$health, math$Dalc)
#Little to no correlation, but still positive
```

28) absences - number of school absences (numeric: from 0 to 93)

```{r}
math %>% 
  select(Walc, Dalc, absences) 

table(math$absences)
```

29) G1 - first period grade (numeric: from 0 to 20)
30) G2 - second period grade (numeric: from 0 to 20)
31) G3 - final grade (numeric: from 0 to 20, output target)





## Part 3: Run regression model

We first try to run a regression model based on all the variables.

```{r}
summary(lm(Dalc~., data=students))
```

